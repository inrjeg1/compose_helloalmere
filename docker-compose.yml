version: '2.0'
services:
  helloalmere:
    image: "rj100/helloalmere"    
  register_service:
    image: "rj100/register_service"
    environment:
      - "SPRING_PROFILES_ACTIVE=prod"
    depends_on:
      - postgres   
  # infra
  postgres:
    image: "rj100/postgres"
    volumes:
      - ./postgres-data:/var/lib/postgresql/data
    ports: 
      - "5432:5432"
  web:
    image: nginx
    volumes:
      - ./mysite.template:/etc/nginx/conf.d/mysite.template
    ports:
      - "8080:80"
    environment:
      - NGINX_HOST=helloalmere.com
      - NGINX_PORT=80
    command: /bin/bash -c "envsubst < /etc/nginx/conf.d/mysite.template > /etc/nginx/conf.d/default.conf && exec nginx -g 'daemon off;'"
    depends_on:
      - register_service   
  
  
